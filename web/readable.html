<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>news</title>

    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/normalize.css" type="text/css">
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura-ink.css" media="screen" />
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura-dark.css"
        media="screen and (prefers-color-scheme: dark)" />
    <link rel="stylesheet" href="css/readable-styles.css">
    <script src="https://unpkg.com/showdown/dist/showdown.min.js" defer></script>
    <script src="https://unpkg.com/alpinejs/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/dayjs"></script>
    <script defer src="js/news-common.js"></script>
</head>

<body>
    <div x-data="{
        timeUntilNext: '',
        until8: '',
        init() {
            initializeAndUpdateTimeInfo(this);
        }
    }" x-init="init()">
        Next update in <span x-text="timeUntilNext ? timeUntilNext : 'calculating...'"></span> (<span x-text="until8 ? until8 : '...' "></span>)
    </div>
    <main x-data="{
        data: [],
        loading: true,
        error: '',
        init() {
            fetchNewsSummaries()
                .then(responseData => {
                    this.data = responseData.items;
                    this.loading = false;
                })
                .catch(error => {
                    console.error('Error fetching news:', error);
                    this.error = 'Failed to load news summaries. Please try again later.';
                    this.loading = false;
                });
        },
        converter: globalConverter,
    }" x-init="init()">
        <h1>news summaries</h1>

        <div x-show="loading" class="loading">Loading news summaries...</div>
        <div x-show="error" x-text="error" class="error"></div>

        <template x-for="(item, idx) in data" :key="item.id">
            <article x-data="{ date: dayjs(item.created) }">
                <fieldset>
                    <legend>Summary for <b x-text="date.format('YYYY-MM-DD HH:mm:ss')"></b></legend>
                    <div x-html="converter.makeHtml(item.content)"></div>
                </fieldset>
            </article>
        </template>
    </main>
</body>

</html>