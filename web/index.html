<!DOCTYPE html>
<html lang="en" class="tui-bg-green-white">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>news</title>

    <link rel="stylesheet" href="https://unpkg.com/tuicss" />
    <script src="https://unpkg.com/tuicss/dist/tuicss.min.js"></script>
    <script src="https://unpkg.com/showdown/dist/showdown.min.js" defer></script>
    <script src="https://unpkg.com/alpinejs/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/dayjs"></script>
    <script defer src="js/news-common.js"></script>
</head>

<body>
    <div style="margin-top:1rem;padding:1rem;" x-data="{
        timeUntilNext: '',
        until8: '',
        init() {
            initializeAndUpdateTimeInfo(this);
        }
    }" x-init="init()">
        <div class="tui-progress-bar tui-bg-red-black w-full" style="width:100%;">
            <span class="tui-progress red-168 white-255-text"
                x-bind:style="{width: `${(24 - parseFloat(until8.split(':')[0]))/24*100}%`, fontSize: '10px', padding:'0.2rem'}"
                x-text="timeUntilNext ? 'Time until next article: ' + timeUntilNext : 'Calculating...'">
            </span>
        </div>
    </div>
    <main class="container mx-auto bg-green-500" x-data="{
        data: [],
        loading: true,
        error: '',
        init() {
            fetchNewsSummaries()
                .then(responseData => {
                    this.data = responseData.items;
                    this.loading = false;
                })
                .catch(error => {
                    console.error('Error fetching news:', error);
                    this.error = 'Failed to load news summaries. Please try again later.';
                    this.loading = false;
                });
        },
        converter: globalConverter,
    }" x-init="init()">
        <h1>news summaries</h1>

        <div x-show="loading">Loading news summaries...</div>
        <div x-show="error" x-text="error" style="color: red;"></div>

        <template x-for="(item, idx) in data" :key="item.id">
            <article class="tui-window" x-data="{ date: dayjs(item.created) }">
                <fieldset class="tui-fieldset">
                    <legend class="tui-legend">Summary for <b x-text="dayjs(item.created).format('YYYY-MM-DD HH:mm:ss')"></b></legend>
                    <div x-html="converter.makeHtml(item.content)"></div>
                </fieldset>
            </article>
        </template>
    </main>
</body>

</html>